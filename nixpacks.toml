# Railway builds from repo root, so we need to handle the server subdirectory
[phases.setup]
nixPkgs = ["nodejs_20"]

[phases.install]
cmds = ["cd server && npm ci --include=dev"]

[phases.build]
cmds = [
  "cd server && npm run build",
  "ls -la server/dist || echo 'Build failed - dist directory not found'",
  "test -f server/dist/server.js || (echo 'ERROR: server.js not found after build' && exit 1)"
]

[start]
cmd = "cd /app/server && npm start"
