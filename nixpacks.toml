# Railway builds from repo root, so we need to handle the server subdirectory
# IMPORTANT: In Railway dashboard, set Service Root Directory to "/server" 
# OR ensure this nixpacks.toml is at the repo root (which it is)

[phases.setup]
nixPkgs = ["nodejs_20"]

[phases.install]
cmds = ["cd server && npm ci --include=dev"]

[phases.build]
cmds = [
  "cd server && npm run build",
  "cd server && ls -la dist/ || (echo 'ERROR: dist directory not found' && exit 1)",
  "cd server && test -f dist/server.js || (echo 'ERROR: server.js not found after build' && exit 1)",
  "echo 'âœ“ Build successful: dist/server.js exists'"
]

[start]
cmd = "cd /app/server && node dist/server.js"
